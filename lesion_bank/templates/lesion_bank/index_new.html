{% load static %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="Joseph Turner">
    <meta name="generator" content="Hugo 0.84.0">

    <!-- This might need to be dynamically generated by Django -->
    <title>LesionBank</title> 

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Bootstrap Icons-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- Papaya -->
    <link rel='stylesheet' type='text/css' href='https://cdn.jsdelivr.net/gh/rii-mango/Papaya@build-1449/release/current/minimal/papaya.css'/>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/rii-mango/Papaya@build-1449/release/current/minimal/papaya.js"></script>
    
    <!-- DataTables Bootstrap Integration -->
    
    <!-- DataTables Bootstrap 5 CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">

    <!-- DataTables Buttons Bootstrap 5 CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">

    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

    <!-- DataTables Bootstrap 5 integration -->
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

    <!-- FixedHeader JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>

    <!-- FixedHeader CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css">

    <!-- DataTables Buttons -->
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>

    <!-- Buttons Bootstrap 5 integration -->
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>

    <!-- JSZip for Buttons extension -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- pdfmake for Buttons extension -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

    <!-- Buttons extensions (HTML5 export, Print view, Column visibility) -->
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.colVis.min.js"></script>

    <meta name="theme-color" content="#7952b3">


    <!-- <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        /* Show it is fixed to the top */
        body {
            min-height: 75rem;
            padding-top: 4.5rem;
        }

        .papaya-menu{
            width: unset !important;
        }

        .dtfh-floatingparenthead{
            background-color:white!important;
            /* z-index: 1000 !important;
            margin: 0 !important;
            padding: 0 !important;
            height: 80 px !important; */
        }
        table.table-hover.dataTable.no-footer.fixedHeader-floating {
            margin-top:0 !important;
            margin-bottom:0 !important;
            border-bottom: 1px solid black !important;
        }
    </style> -->

</head>

<!-- <body class="bg-light min-vh-100 d-flex flex-column"> -->
<body>
<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <div class="container d-flex justify-content-center align-items-center">
        <img src="/static/images/lesion_logo_without_background.png" alt="Logo" class="d-inline-block align-text-top" width="60" height="60">
        <a class="navbar-brand" href="#">Lesion<b>Bank</b></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav me-auto mb-2 mb-md-0">
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="#">Case Studies</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Symptoms</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Locations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Predict</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">FAQ</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<main class="container">
    <div class="p-5 rounded">
        <img src="/static/images/lesion_logo_without_background.png" alt="Logo" class="d-inline-block align-middle" width="100" height="100">
        <h1 class="d-inline-block align-middle fs-1">www.Lesion<b>Bank</b>.org</h1>
        <br>
        <br>
        <p class="lead">
            LesionBank is a dedicated platform for lesion network mapping analysis, including:
        </p>
        <div class="list-group list-group-flush">
            <a href="#" class="h5 list-group-item list-group-item-action bg-light border-0"><i class="bi bi-dot"></i>A searchable database of published human brain lesion case reports</a>
            <a href="#" class="h5 list-group-item list-group-item-action bg-light border-0"><i class="bi bi-dot"></i>A collection of neurological symptoms mapped to brain networks</a>
            <a href="#" class="h5 list-group-item list-group-item-action bg-light border-0"><i class="bi bi-dot"></i>On-demand generation of lesion network maps</a>
            <a href="#" class="h5 list-group-item list-group-item-action bg-light border-0"><i class="bi bi-dot"></i>Automated decoding of brain lesions</a>
        </div>        
        <br>
        <p class="lead">
            LesionBank explores the relationship between brain lesions and neurological symptoms, creating results like this:
            <br>
            <br>
        </p>
        <!-- <div class="row">
            <div class="text-center">
                <h5><i>
                    <a target="_blank" href="{% url 'symptom_detail' symptom %}">{{ symptom }}</a>
                    Sensitivity Map derived from {{case_count}} Lesions
                </i></h5>
            </div>              
            <div class="col-md-6">
              <div class="table-responsive">
                <table id="example" class="table table-hover">
                    <thead id="tableHeader" class="thead-light">
                        <tr>
                            <th>Author</th>
                            <th>DOI</th>
                            <th>Lesion</th>
                            <th>Network</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for case in case_studies %}
                            <tr>
                                <td><a href="{% url 'cases_single' case.lesion_id %}" target="_blank">{{case.author}}, {{case.publication_year}}</a></td>
                                <td><a href="{{case.doi}}" target="_blank">doi</a></td>
                                <td>
                                    <i url='{{ MEDIA_URL }}{{ case.lesion_mask }}' id='2toggle{{forloop.counter}}' style="color:red; font-size: 22px; cursor: pointer;" class="bi bi-square" onclick="addNewOverlay('{{ MEDIA_URL }}{{ case.lesion_mask }}', this)"></i> 
                                </td>
                                <td>
                                    <i url='{{ MEDIA_URL }}{{ case.lesion_network_map }}' id='2toggle{{forloop.counter}}' style="color:#ff999e; font-size: 22px; cursor: pointer;" class="bi bi-square" onclick="addNewOverlay('{{ MEDIA_URL }}{{ case.lesion_network_map }}', this)"></i> 
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
              </div>
            </div>
            <div class="col-md-6">
                <div id="papaya-holder" class="papaya" data-params="params"></div>
            </div>
        </div> -->
        <hr>
    </div>
    <div class="d-flex justify-content-center flex-wrap">
        <img src="/static/images/byu_logo_navy.png" class="img-fluid" style="max-height: 80px;"> 
        <img src="/static/images/Brigham_and_Womens_Hospital_logo.svg.png" class="img-fluid" style="max-height: 80px;">
        <img src="/static/images/cbct_logo_dark.png" class="img-fluid" style="max-height: 80px;">
        <img src="/static/images/harvard_med_logo.png" class="img-fluid" style="max-height: 80px;">
    </div>
    <br>
    <br>
</main>

<!-- <footer class="footer mt-auto py-3 bg-dark">
    <div class="container">
        <span class="text-muted">
            Supported By:
            <b>Brigham Young University</b>
        </span>
    </div>
</footer> -->
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<!-- DataTable Initializing on Table Element -->
<script>
    $(document).ready(function() {
        $('#example').DataTable({
            fixedHeader: true,
            searching: false,
            info: false,
            "bLengthChange": false,
            pageLength: 0,
            lengthMenu: [[7, 10, 20, 35, 50, 100, -1], [10, 20, 35, 50, 100, "All"]],
            // dom: 'Bfrtip',
            // buttons: [
            //     'copy', 'csv', 'excel', 'pdf', 'print'
            // ]
        });
    });
</script>

<!-- Functions for loading overlays -->

<script type="text/javascript">

    function addNewOverlay(link, element){
            if(params[link.split('/').pop()]){
                let viewer = papayaContainers[0].viewer;
                let overlays = viewer.screenVolumes;
                let overlay_list = overlays.map(overlay => overlay.volume.urls[0]);
                if(overlay_list.includes(link)){
                    i = overlay_list.indexOf(link);
                    viewer.toggleOverlay(i);
                }
                else{
                    if(params[link.split('/').pop()].parametric = true){
                        papaya.viewer.Viewer.MAX_OVERLAYS += 2;
                    }
                    else{
                        papaya.viewer.Viewer.MAX_OVERLAYS +=1
                    }
                    viewer.loadOverlay([link],true,false,false);
                }
                if(element instanceof HTMLElement) {
                    element.classList.toggle("bi-square-fill");
                    element.classList.toggle("bi-square");
                }
            }
    }
    function loadFirstOverlay(){
        setTimeout(() => {
            let element = document.getElementById("toggle1");
            let link = element.getAttribute('url')
            addNewOverlay(link, element);
        }, 10);
    }
</script>

<!-- Papaya Initialization -->
<script type="text/javascript">
    var params = {};
    params["images"] = [
        "https://neurovault.org/static/images/GenericMNI.nii.gz",
        '{{ MEDIA_URL }}{{ sensitivity_map}}'
    ];
    params["luts"] = [
        {"name":"Lesion Trace", "data": [[0, 0.9, 0.2, 0.2], [1, 1, 0.2, 0.2]]},
        {"name":"PuBu", "data":[[0,1,0.968627,0.984314],[0.05,0.92549,0.905882,0.94902],[0.1,0.815686,0.819608,0.901961],[0.15,0.65098,0.741176,0.858824],[0.2,0.454902,0.662745,0.811765],[0.25,0.211765,0.564706,0.752941],[0.3,0.0196078,0.439216,0.690196],[0.35,0.0156863,0.352941,0.552941],[.4,0.00784314,0.219608,0.345098],[1.0,0.00784314,0.219608,0.345098]]},
        {"name":"OrRd", "data":[[0,1,0.968627,0.92549],[0.125,0.996078,0.909804,0.784314],[0.25,0.992157,0.831373,0.619608],[0.375,0.992157,0.733333,0.517647],[0.5,0.988235,0.552941,0.34902],[0.625,0.937255,0.396078,0.282353],[0.75,0.843137,0.188235,0.121569],[0.875,0.701961,0,0],[1,0.498039,0,0]]},
        {"name":"PuBuNotParametric", "data":[[0,1,0.968627,0.984314],[0.125,0.92549,0.905882,0.94902],[0.25,0.815686,0.819608,0.901961],[0.375,0.65098,0.741176,0.858824],[0.5,0.454902,0.662745,0.811765],[0.625,0.211765,0.564706,0.752941],[0.75,0.0196078,0.439216,0.690196],[0.875,0.0156863,0.352941,0.552941],[1,0.00784314,0.219608,0.345098]]}
    ]
    params["{{ sensitivity_map }}".split('/').pop()] = {'min': 50, 'max': 100, 'alpha': 0.6, 'lut': "OrRd", 'negative_lut':'PuBuNotParametric', 'parametric':true, 'symmetric':true}
    {% for case in case_studies %}
        params["{{case.lesion_mask}}".split('/').pop()] = {lut: "Lesion Trace", "alpha":1.0};
        params["{{case.lesion_network_map}}".split('/').pop()] = {'parametric': true, 'min': 25, 'max': 100, 'alpha': 0.6, lut: "OrRd", 'negative_lut':'PuBu', 'symmetric':false};
    {% endfor %}
    params["worldSpace"] = true;
    params["expandable"] = true;
    params["combineParametric"] = true;
    params["showControls"] = false;
    params["smoothDisplay"] = false;
    params["allowScroll"] = false;
    // params["loadingComplete"] = loadFirstOverlay;
</script>   
</body>
</html>